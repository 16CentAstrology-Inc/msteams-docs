### YamlMime:Tutorial
title: Build your tab app with Teams SSO
metadata:
  title: Build your tab app with Teams SSO
  description: In this tutorial, you'll learn to implement Teams SSO in your tab app
  audience: Developer
  level: Beginner
  ms.date: 10/21/2021
  ms.topic: interactive-tutorial
  nextTutorialHref: ~/concepts/authentication/authentication.md
  nextTutorialTitle: Back to Authentication overview
  ms.custom: mvc
  ms.localizationpriority: high
items:
- durationInMinutes: 1
  content: |
    Implement Teams SSO in your Microsoft Teams tab app.
    You'll create a tab app and configure it to authenticate app users with Teams SSO.

- title: Prerequisites
  durationInMinutes: 1
  content: |

   Here's a list of prerequisites for authenticating your app users with Teams SSO for your tab app:

   1. A Teams tab app: You can use the Get started sample available for Teams Toolkit and Visual Studio Code to build a sample tab app.

   1. Register your tab app with Azure AD: Your Teams app users are authenticated using their Teams user credentials and Azure AD provides an access token for them.

   1. Update the manifest file: After you register your app in Azure AD, update the app properties in your app's manifest file.

   1. Get an access token: This step requires your app user to give their consent for using their credentials for user-level permission. Azure AD receives the user credentials and sends an access token to Teams.

   The token is parsed in the tab application using JavaScript, to extract required information, such as the user's email address.

    > [!NOTE]
    > The getAuthToken() is only valid for consenting to a limited set of user-level APIs that is email, profile, offline_access, and OpenId. It is not used for further Graph scopes such as User.Read or Mail.Read. For suggested workarounds, see Get an access token with Graph permissions.

    > [!IMPORTANT]
    > Only user-level Graph API permissions are supported that is, email, profile, offline_access, OpenId. If you must have access to other Graph scopes such as User.Read or Mail.Read, see Get an access token with Graph permissions.
    > It is important that your application's domain name is the same as the domain name you have registered for your Azure AD application.
    > Currently multiple domains per app are not supported.
    > The user must set accessTokenAcceptedVersion to 2 for a new application.

- title: Register tab app with Azure AD
  durationInMinutes: 1
  content: |  

   This section describes the tasks involved in creating a Teams tab that uses SSO. These tasks are language- and framework-agnostic. 

   > [!NOTE]
   > The Microsoft Teams Toolkit can to register the Azure Active Directory (Azure AD) application in a single sign-in (SSO) project.

   In this exercise, you'll learn how to manually register and configure the Azure AD app that can be used to implement SSO in a Microsoft Teams app.

   To complete the registration of your tab app in Azure AD:

   1. [Register your app](#register-your-app)
   1. Configure API permissions with Microsoft Graph
   1. Expose an API for the app and define app scope 
   

   ## Register your app

   In this section, you'll learn to create and register an Azure-based Teams tab app. 

   To register your tab app in Azure AD:

   1. Open a web browser to the [Azure portal](https://ms.portal.azure.com/).
      The Microsoft Azure Portal page opens. 
   
   1. Select **App registrations** icon. 
      
      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/azure-portal.png" alt-text="Azure Portal page." border="false":::

      The **App registrations** page appears.

   1. Select **+ New registration** icon.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/app-registrations.png" alt-text="New registration page on Azure Portal." border="false":::
      
      The **Register an application** page appears.
   
   1. Enter the app details for your tab app.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/register-app.png" alt-text="App registration page on Azure Portal." border="false":::

      1. Enter the name of your app that will be displayed to the user.
         You can change this name at a later stage, if you want to.

      1. Select the intended types of user accounts that can access your app. For this tutorial, select **Accounts in this organizational directory only (Microsoft only - Single tenant)**.

   1. Select the **Redirect URI** details.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/redirect-uri.png" alt-text="App registration page on Azure Portal." border="true":::

      1. Select the platform where your app will be accessible.
      1. Enter URL for your app. After user authentication is successful, Teams uses this URL to open your app. 
         You can change this URL at a later stage, if needed.

   1. Select **Register**.   
      A message pops up on the browser stating that the app was created.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/app-created-msg.png" alt-text="App registration page on Azure Portal." border="true":::

      The app is created and displayed.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/tab-app-created.png" alt-text="App registration page on Azure Portal." border="false":::

    1. Note and save the **Application ID**. You'll need it for updating the app manifest.

    Your Teams tab app is created.

   ## Configure API permissions with Microsoft Graph

   In this section, you'll learn to configure API permissions with Microsoft Graph, such as User.Read, email, offline_access, and more.

   To configure API permissions:

   1. Select **Manage** > **API permission** from the left pane.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/api-permission-menu.png" alt-text="App permissions menu option." border="false":::

      The **API permissions** page appears.

   1. Select **+ Add permissions** to add Microsoft Graph API permissions.
      
      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/app-permission.png" alt-text="App permissions page." border="false":::
      
      The **Request API permissions** page appears.

   1. Select **Microsoft Graph**.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/request-api-permission.png" alt-text="Request API permissions page." border="true":::

      The options for Graph permissions display.

   1. Select **Delegated permissions** to view the list of possible permission that you can select.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/delegated-permission.png" alt-text="Delegated permissions." border="true":::

   1. Select relevant permissions for your app. For this tutorial, select **email** and **offline_access**, and then select **Add permissions**.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/select-permission.png" alt-text="Delegated permissions." border="true":::

      A message pops up on the browser stating that the app was created.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/updated-permission-msg.png" alt-text="Delegated permissions." border="false":::

      The added permissions are displayed in the **API permissions** page.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/configured-permissions.png" alt-text="Delegated permissions." border="true":::

   Next, you will expose API and define scope.    
  
   ## Expose an API for the app and define app scope

   In this section, you'll learn to expose an API and define the app scope.

   To expose an API:

   1. Select **Manage** > **Expose an API** from the left pane.
      
      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/expose-api-menu.png" alt-text="Expose an API menu option." border="false":::

      The **Expose an API** page appears.

   1. Select **Set** to generate app ID URI.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/expose-an-api.png" alt-text="Expose an API menu option." border="false":::

      The section for setting app ID URI appears.

   1. Enter the app ID URI, and then select **Save**.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/set-app-id-uri.png" alt-text="App ID URI" border="true":::

      A message pops up on the browser stating that the app ID URI was updated. 

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/app-id-uri-msg.png" alt-text="App ID URI message" border="false":::

      The app ID URI displays on the page.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/app-id-uri-added.png" alt-text="App ID URI updated" border="false":::

   1. Select **+ Add a scope** in the **Scopes defined by this API** section.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/select-scope.png" alt-text="Select scope" border="true":::

      The **Add a scope** page appears.

   1. Enter the app details for your app scope.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/add-scope.png" alt-text="Add scope details" border="true":::

      1. Enter the scope name. This is a mandatory field.
      1. Select **Admins and users** to configure the users who can give consent to use user's login credentials. The default option is **Admins only**.
      1. Enter the **Admin consent display name**. This is a mandatory field.
      1. Enter the description for admin consent. This is a mandatory field.
      1. Enter the **User consent display name**.
      1. Enter the description for user consent description.
      1. Select the **Enabled** option for state.
      1. Select **Add scope**.

      A message pops up on the browser stating that the scope was added. 

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/scope-added-msg.png" alt-text="Scope added message" border="false":::

      The app ID URI displays on the page.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/scope-added.png" alt-text="Scope added and displayed" border="false":::

   1. Move through the page to the **Authorized client application** section, and select **+ Add a client application**.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/auth-client-apps.png" alt-text="Authorized client application" border="false":::

      The **Add a client application page appears.

   1. Enter the details for adding a client application. For this tutorial, you'll add two client applications.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/add-client-app.png" alt-text="Add a  client application" border="true":::
      
      1. Enter **1fec8e78-bce4-4aaf-ab1b-5451cc387264** as client ID for Teams mobile or desktop application.
      1. Select the app ID you created for your app for the **Authorized scopes**.
      1. Select **Add application**.

      A message pops up on the browser stating that the client app was added. 

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/update-app-auth-msg.png" alt-text="Client application added message" border="false":::

      The app ID URI displays on the page.

   1. Repeat the previous step to add client app for Teams web application.
      
      1. Enter **5e3ce6c0-2b1f-4285-8d4b-75ee78787346** as client ID for web app.
      1. Select the app ID you created for your app for the **Authorized scopes**.
      1. Select **Add application**.

      A message pops up on the browser stating that the client app was added. 

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/update-app-auth-msg.png" alt-text="Client application added message for web app" border="false":::

      The app ID URI displays on the page.

      :::image type="content" source="~/assets/images/authentication/teams-sso-tabs/client-app-added.png" alt-text="Client app added and displayed" border="false":::

       